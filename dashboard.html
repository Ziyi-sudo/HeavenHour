<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>æˆ‘çš„ä¸“æ³¨è®°å½• - HavenHours Dashboard</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <h2>ğŸ“Š æˆ‘çš„ä¸“æ³¨è®°å½•</h2>
    <div id="summary"></div>
    <div id="recordList"></div>
    <canvas id="taskChart" width="400" height="200"></canvas>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // è¯»å– localStorage é‡Œçš„æ•°æ®
    const records = JSON.parse(localStorage.getItem("havenRecords")) || [];

    // æ•°æ®ç»Ÿè®¡
    let totalSeconds = 0;
    let taskMap = {};

    records.forEach(r => {
      const parts = r.duration.split(":");
      const seconds = parseInt(parts[0]) * 3600 + parseInt(parts[1]) * 60 + parseInt(parts[2]);
      totalSeconds += seconds;

      taskMap[r.taskName] = (taskMap[r.taskName] || 0) + seconds;
    });

    // è½¬æ¢æ—¶é—´æ ¼å¼
    const hours = Math.floor(totalSeconds / 3600);
    const minutes = Math.floor((totalSeconds % 3600) / 60);

    document.getElementById("summary").innerHTML =
      `<p>ä»Šæ—¥ç´¯è®¡ä¸“æ³¨ï¼š<strong>${hours}å°æ—¶ ${minutes}åˆ†é’Ÿ</strong></p>`;

    // ä»»åŠ¡åˆ—è¡¨å±•ç¤º
    document.getElementById("recordList").innerHTML = records.map(r => `
      <div>ğŸ“ <strong>${r.taskName}</strong>ï¼š${r.startTime} ~ ${r.endTime} (${r.duration})</div>
    `).join("");

    // ç”¨ Chart.js ç”»å›¾
    const ctx = document.getElementById("taskChart").getContext("2d");
    new Chart(ctx, {
      type: "bar",
      data: {
        labels: Object.keys(taskMap),
        datasets: [{
          label: "å„ä»»åŠ¡æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰",
          data: Object.values(taskMap).map(s => Math.floor(s / 60)),
          backgroundColor: "rgba(75, 192, 192, 0.6)"
        }]
      }
    });
  </script>
</body>
</html>